<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Page</title>
    <link href="https://unpkg.com/@microsoft/atlas-css/dist/index.css" rel="stylesheet" />
    <link rel="stylesheet" href="../static/nav.css">
    <link rel="stylesheet" href="../static/login.css">
    <script defer src="../static/nav.js"></script>
    <style>
        /* Add your additional styles here if needed */
    </style>
</head>
<body>
    <br>
    <br>
    <br>
    <center><h1>My Account</h1></center>
    <div class="container">
        <!-- Login Form -->
        <form name="loginForm" id="loginForm">
            <label for="username">Username: <span style="color:red">*</span></label>
            <input class="username" type="text" id="username" name="username" required>
            <label for="password">Password: <span style="color:red">*</span></label>
            <input type="password" class="password" name="password" id="password" required>
            <label for="firstname">First Name:</label>
            <input class="firstname" type="text" id="firstname" name="firstname">
            <label for="lastname">Last Name:</label>
            <input class="lastname" type="text" id="lastname" name="lastname">
            <label for="email">Email:</label>
            <input class="email" type="text" id="email" name="email">
            <input id="login-btn" type="submit" class="button button-primary button-filled" value="Login"></input>
            <div id="file-upload-section">
                <label for="front_image">Front image:</label>
                <input type="file" id="front_image" accept="image/*" onchange="loadFile(event)">
                <img id="output" alt="Front Image Preview"/>
    
                <label for="left_image">Left image:</label>
                <input type="file" id="left_image" accept="image/*" onchange="previewImage(event)">
                <img id="preview" alt="Left Image Preview"/>
    
                <label for="right_image">Right image:</label>
                <input type="file" id="right_image" accept="image/*" onchange="loadFile(event)">
                <img id="output" alt="Right Image Preview"/>
            </div>
        </form>

        <!-- File Upload Section -->
    </div>
</body>
<script>
    function loadFile(event) {
        // const output = document.getElementById('output');
        // output.src = URL.createObjectURL(event.target.files[0]);
        // output.onload = () => {
        //     URL.revokeObjectURL(output.src); // Free memory
        // };
    }

    function previewImage(event) {
        // const reader = new FileReader();
        // reader.onload = () => {
        //     const output = document.getElementById('preview');
        //     output.src = reader.result;
        // };
        // reader.readAsDataURL(event.target.files[0]);
    }

    // function login() {
    const login = (event) => {
        event.preventDefault();
        console.log("Login button clicked");
        console.log("Form submitted");
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;

        const formData = new FormData();
        formData.append("username", username);
        formData.append("password", password);

        const front_input = document.getElementById("front_image");
        const left_input = document.getElementById("left_image");
        const right_input = document.getElementById("right_image");

        let front_image = null;
        let left_image = null;
        let right_image = null;

        let url = "http://127.0.0.1:8000/login/";

        if (front_input.files.length > 0 && left_input.files.length > 0 && right_input.files.length > 0) {
            front_image = document.getElementById("front_image").files[0];
            left_image = document.getElementById("left_image").files[0];
            right_image = document.getElementById("right_image").files[0];

            formData.append("front_image", front_image);
            formData.append("left_image", left_image);
            formData.append("right_image", right_image);
            
            url = "http://127.0.0.1:8000/signup/";
        }

        fetch(url, {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (Object.hasOwn(data, "success") && data.success == true) {
                alert("Login successful!");
                window.location.href = "results.html";
            } else {
                alert("Login failed. Please try again.");
                console.log(data)
            }
        })
    }

    document.addEventListener("DOMContentLoaded", () => {
        document.getElementById('loginForm').addEventListener("submit", login);
    })
</script>
</html>
